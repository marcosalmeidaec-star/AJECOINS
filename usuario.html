<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AJE Coins</title>

<link rel="stylesheet" href="usuario.css"/>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script type="text/javascript">
   (function(){
      // InicializaciÃ³n con tu Public Key
      emailjs.init("9ynguWEQzb63q7ITx");
   })();
</script>

<script src="usuario.js" defer></script>
</head>
<body>

<header class="topBar">
  <img src="assets/logo.png" class="logo">
  <span>AJE Coins</span>
</header>

<main class="main-container">

  <section id="login" class="card">
    <h2>Ingresa</h2>

    <select id="cedisInput" style="width: 100%; padding: 10px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #ccc;">
      <option value="">Cargando sedes...</option>
    </select>

    <input id="cedulaInput" type="text" placeholder="CÃ³digo de Vendedor" maxlength="10">
    <input id="passwordInput" type="password" placeholder="ContraseÃ±a">

    <button id="ingresarBtn">Entrar</button>
    
    <p style="text-align:center; margin-top:15px;">
      <a href="#" id="olvideLink" style="color:#007a5a; font-size:14px; text-decoration:none; font-weight:bold;">Â¿Olvidaste tu contraseÃ±a?</a>
    </p>

    <p id="errorMsg" class="error"></p>

    <p style="font-size:12px;color:#777;text-align:center; margin-top:10px;">
      Tu contraseÃ±a inicial es tu cÃ³digo de vendedor
    </p>
  </section>

  <section id="cuenta" class="card-wide hidden">

    <div class="user-layout">
      <aside class="user-sidebar">
        <div class="saldoHead">
          <span>Mis coins</span>
          <strong id="coins">0</strong>
        </div>

        <ul id="datos" class="datos"></ul>

        <div class="acordeon-contenedor">
            <button id="btnDesplegarHistorial" class="btn-acordeon">
                ğŸ“œ Ver mis movimientos <span>+</span>
            </button>
            
            <div id="historialAcordeon" class="card-content-desplegable hidden">
                <div style="overflow-x:auto;">
                    <table id="tablaMovimientosUsuario" style="width:100%; border-collapse: collapse; font-size: 13px;">
                        <thead>
                            <tr style="background-color: #007a5a; color: white;">
                                <th style="padding: 10px; text-align: left;">Fecha</th>
                                <th style="padding: 10px; text-align: left;">Concepto</th>
                                <th style="padding: 10px; text-align: center;">Coins</th>
                                <th style="padding: 10px; text-align: center;">Saldo</th>
                            </tr>
                        </thead>
                        <tbody id="movimientosBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="passwordBox">
          <h4>ğŸ” Seguridad</h4>
          <button id="btnCambiarPass">Cambiar contraseÃ±a</button>
        </div>

        <h3>Carrito <span id="bolsa">0</span></h3>
        <ul id="carritoList" class="carrito"></ul>
        
        <button id="cerrarBtn" style="margin-top: 20px; width: 100%;">Cerrar sesiÃ³n</button>
      </aside>

      <div class="user-content">
        <h3>Tienda de Premios</h3>
        <div id="productosTienda" class="tienda"></div>
      </div>
    </div>

  </section>

</main>

<div id="modalCorreo" class="modal hidden">
  <div class="modal-content">
    <h4>ğŸ“§ Registro de Correo</h4>
    <p style="font-size:13px; color:#666;">Por favor, registra un correo para poder recuperar tu cuenta en caso de olvido.</p>
    <input type="email" id="emailRegistroInput" placeholder="tu@correo.com">
    <button id="btnGuardarEmail">Guardar y Continuar</button>
  </div>
</div>

<div id="modalRecuperar" class="modal hidden">
  <div class="modal-content">
    <h4 id="tituloRecuperar">Recuperar Acceso</h4>
    <div id="step1Recuperar">
      <select id="cedisRecuperar" style="width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #ccc;">
        <option value="">Cargando sedes...</option>
      </select>
      <input type="text" id="codRecuperar" placeholder="CÃ³digo de Vendedor">
      <input type="email" id="emailRecuperar" placeholder="Correo electrÃ³nico">
      <button id="btnEnviarCodigo">Enviar CÃ³digo</button>
    </div>
    <div id="step2Recuperar" class="hidden">
      <input type="text" id="codigoVerificacionInput" placeholder="CÃ³digo de 6 dÃ­gitos">
      <input type="password" id="nuevaPassInput" placeholder="Nueva ContraseÃ±a">
      <button id="btnRestablecer">Restablecer ContraseÃ±a</button>
    </div>
    <button class="sec" id="btnCerrarRecuperar" style="margin-top:10px;">Cancelar</button>
  </div>
</div>

<div id="modalFin" class="modal hidden">
  <div class="modal-content">
    <h4>Resumen de Pedido</h4>
    <ul id="resumenList"></ul>
    <p id="totalFin" style="font-weight:bold;"></p>
    <button id="btnConfirmar">Confirmar Canje</button>
    <button id="btnCancelar" class="sec">Volver</button>
  </div>
</div>

<div id="loader" class="loader hidden">
  <div class="spinner"></div>
  <p>Procesandoâ€¦</p>
</div>

</body>
</html>
